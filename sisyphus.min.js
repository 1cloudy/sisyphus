$.sisyphus=function(){return Sisyphus.getInstance()},$.fn.sisyphus=function(a){var b=Sisyphus.getInstance();b.setOptions(a),b.protect(this)};var Sisyphus=function(){function b(){return{setOptions:function(a){var b={excludeFields:null,customKeyPrefix:"",timeout:0,onSaveCallback:function(){},onRestoreCallback:function(){},onReleaseDataCallback:function(){}};this.options=$.extend(b,a)},protect:function(a){if(!this.isLocalStorageAvailable())return!1;this.href=location.hostname+location.pathname+location.search;var b=this;return a.each(function(){var a=$(this),c=a.find(":input").not(":submit").not(":reset").not(":button");b.bindSaveAndRestoreData(c),b.bindReleaseDataOnSubmitOrReset(c)}),!0},isLocalStorageAvailable:function(){try{return localStorage.getItem}catch(a){return!1}},bindSaveAndRestoreData:function(a){var b=this,c=!1,d=a.parents("form").attr("id");a.each(function(){var a=$(this),e=b.href+d+a.attr("name")+b.options.customKeyPrefix,f=localStorage.getItem(e);f&&(b.restoreData(a,f),c=!0),a.is(":text")||a.is("textarea")?b.options.timeout||b.bindSaveDataImmediately(a,e):b.bindSaveDataOnChange(a,e)}),b.options.timeout&&b.bindSaveDataByTimeout(a),c&&$.isFunction(b.options.onRestoreCallback)&&b.options.onRestoreCallback.call()},restoreData:function(a,b){a.is(":checkbox")&&b!==!1&&a.attr("name").indexOf("[")===-1?a.attr("checked","checked"):a.is(":radio")?a.val()===b&&a.attr("checked","checked"):a.attr("name").indexOf("[")===-1?a.val(b):(b=b.split(","),a.val(b))},bindSaveDataImmediately:function(a,b){var c=this;$.browser.msie==null?a.get(0).oninput=function(){c.saveToLocalStorage(b,a.val())}:a.get(0).onpropertychange=function(){c.saveToLocalStorage(b,a.val())}},saveToLocalStorage:function(a,b){try{localStorage.setItem(a,b+"")}catch(c){}b!==""&&$.isFunction(this.options.onSaveCallback)&&this.options.onSaveCallback.call()},bindSaveDataOnChange:function(a,b){var c=this;a.change(function(){var d=a.val();a.is(":checkbox")&&(a.attr("name").indexOf("[")!=-1?(d=[],$("[name='"+a.attr("name")+"']:checked").each(function(){d.push($(this).val())})):d=a.is(":checked")),a.is(":radio")&&(d=a.val()),c.saveToLocalStorage(b,d)})},bindSaveDataByTimeout:function(a){var b=this;setTimeout(function(a){function c(){a.each(function(){var a=$(this);if(a.is(":text")||a.is("textarea")){var c=b.href+a.parents("form").attr("id")+a.attr("name")+b.options.customKeyPrefix;try{localStorage.setItem(c,a.val())}catch(d){}}}),$.isFunction(b.options.onSaveCallback)&&b.options.onSaveCallback.call(),setTimeout(c,b.options.timeout*1e3)}return c}(a),b.options.timeout*1e3)},bindReleaseDataOnSubmitOrReset:function(a){var b=this;a.parents("form").bind("submit reset",function(){b.releaseData(a)})},releaseData:function(a){var b=!1,c=this,d=a.parents("form").attr("id");a.each(function(){field=$(this);var a=c.href+d+field.attr("name")+c.options.customKeyPrefix;localStorage.removeItem(a),b=!0}),b&&$.isFunction(c.options.onReleaseDataCallback)&&c.options.onReleaseDataCallback.call()}}}var a;return{getInstance:function(){return a||(a=b()),a}}}()