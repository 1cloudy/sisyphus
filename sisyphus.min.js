(function(a){a.sisyphus=function(){return Sisyphus.getInstance()},a.fn.sisyphus=function(a){var b=Sisyphus.getInstance();return b.setOptions(a),b.protect(this),b},Sisyphus=function(){function d(){return{setInitialOptions:function(b){var c={excludeFields:null,customKeyPrefix:"",timeout:0,autoRelease:!0,onSave:function(){},onRestore:function(){},onRelease:function(){}};this.options=this.options||a.extend(c,b)},setOptions:function(b){this.options=this.options||this.setInitialOptions(b),this.options=a.extend(this.options,b)},protect:function(d){d=d||{};var e=this;this.targets=this.targets||[],this.href=location.hostname+location.pathname+location.search,this.targets=a.merge(this.targets,d),this.targets=a.unique(this.targets),this.targets=a(this.targets);if(!c.isAvailable())return!1;e.restoreAllData(),this.options.autoRelease&&e.bindReleaseData(),b.started||(e.bindSaveData(),b.started=!0)},bindSaveData:function(){var b=this;b.options.timeout&&b.saveDataByTimeout(),b.targets.each(function(){var c=a(this).attr("id"),d=a(this).find(":input").not(":submit").not(":reset").not(":button");d.each(function(){if(a.inArray(this,b.options.excludeFields)!==-1)return!0;var d=a(this),e=b.href+c+d.attr("name")+b.options.customKeyPrefix;d.is(":text")||d.is("textarea")?b.options.timeout||b.bindSaveDataImmediately(d,e):b.bindSaveDataOnChange(d,e)})})},saveAllData:function(){var b=this;b.targets.each(function(){var c=a(this).attr("id"),d=a(this).find(":input").not(":submit").not(":reset").not(":button");d.each(function(){if(a.inArray(this,b.options.excludeFields)!==-1)return!0;var d=a(this),e=b.href+c+d.attr("name")+b.options.customKeyPrefix,f=d.val();d.is(":checkbox")?(d.attr("name").indexOf("[")!=-1?(f=[],a("[name='"+d.attr("name")+"']:checked").each(function(){f.push(a(this).val())})):f=d.is(":checked"),b.saveToBrowserStorage(e,f,!1)):d.is(":radio")?d.is(":checked")&&(f=d.val(),b.saveToBrowserStorage(e,f,!1)):b.saveToBrowserStorage(e,f,!1)})}),a.isFunction(b.options.onSave)&&b.options.onSave.call()},restoreAllData:function(){var b=this,d=!1;b.targets.each(function(){var e=a(this),f=e.attr("id"),g=e.find(":input").not(":submit").not(":reset").not(":button");g.each(function(){if(a.inArray(this,b.options.excludeFields)!==-1)return!0;var e=a(this),g=b.href+f+e.attr("name")+b.options.customKeyPrefix,h=c.get(g);h&&(b.restoreFieldsData(e,h),d=!0)})}),d&&a.isFunction(b.options.onRestore)&&b.options.onRestore.call()},restoreFieldsData:function(a,b){a.is(":checkbox")&&b!=="false"&&a.attr("name").indexOf("[")===-1?a.attr("checked","checked"):a.is(":radio")?a.val()===b&&a.attr("checked","checked"):a.attr("name").indexOf("[")===-1?a.val(b):(b=b.split(","),a.val(b))},bindSaveDataImmediately:function(b,c){var d=this;a.browser.msie==null?b.get(0).oninput=function(){d.saveToBrowserStorage(c,b.val())}:b.get(0).onpropertychange=function(){d.saveToBrowserStorage(c,b.val())}},saveToBrowserStorage:function(b,d,e){e=e==null?!0:e,c.set(b,d),e&&d!==""&&a.isFunction(this.options.onSave)&&this.options.onSave.call()},bindSaveDataOnChange:function(a,b){var c=this;a.change(function(){c.saveAllData()})},saveDataByTimeout:function(){var a=this,b=a.targets;setTimeout(function(b){function c(){a.saveAllData(),setTimeout(c,a.options.timeout*1e3)}return c}(b),a.options.timeout*1e3)},bindReleaseData:function(){var b=this;b.targets.each(function(c){var d=a(this),e=d.find(":input").not(":submit").not(":reset").not(":button"),f=d.attr("id");a(this).bind("submit reset",function(){b.releaseData(f,e)})})},manuallyReleaseData:function(){var b=this;b.targets.each(function(c){var d=a(this),e=d.find(":input").not(":submit").not(":reset").not(":button"),f=d.attr("id");b.releaseData(f,e)})},releaseData:function(b,d){var e=!1,f=this;d.each(function(){if(a.inArray(this,f.options.excludeFields)!==-1)return!0;var d=a(this),g=f.href+b+d.attr("name")+f.options.customKeyPrefix;c.delete(g),e=!0}),e&&a.isFunction(f.options.onRelease)&&f.options.onRelease.call()}}}var b={instantiated:null,started:null},c={};return c.isAvailable=function(){if(typeof a.jStorage=="object")return!0;try{return localStorage.getItem}catch(b){return!1}},c.set=function(b,c){if(typeof a.jStorage=="object")a.jStorage.set(b,c+"");else try{localStorage.setItem(b,c+"")}catch(d){}},c.get=function(b){if(typeof a.jStorage=="object"){var c=a.jStorage.get(b);return c?c.toString():c}return localStorage.getItem(b)},c.delete=function(b){typeof a.jStorage=="object"?a.jStorage.deleteKey(b):localStorage.removeItem(b)},{getInstance:function(){return b.instantiated||(b.instantiated=d(),b.instantiated.setInitialOptions()),b.instantiated},free:function(){return b={},null}}}()})(jQuery)