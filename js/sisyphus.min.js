$.sisyphus=function(){return Sisyphus.getInstance()},$.fn.sisyphus=function(a){var b=Sisyphus.getInstance();return b.setOptions(a),b.protect(this),b};var Sisyphus=function(){function b(){return{setInitialOptions:function(a){var b={excludeFields:null,customKeyPrefix:"",timeout:0,onSave:function(){},onRestore:function(){},onRelease:function(){}};this.options=this.options||$.extend(b,a)},setOptions:function(a){this.options=this.options||this.setInitialOptions(a),this.options=$.extend(this.options,a)},protect:function(b){b=b||{};var c=this;this.targets=this.targets||[],this.href=location.hostname+location.pathname+location.search,this.targets=$.merge(this.targets,b),this.targets=$.unique(this.targets),this.targets=$(this.targets);if(!this.isLocalStorageAvailable())return!1;c.restoreAllData(),c.bindReleaseData(),a.started||(c.bindSaveData(),a.started=!0)},isLocalStorageAvailable:function(){try{return localStorage.getItem}catch(a){return!1}},bindSaveData:function(){var a=this;a.options.timeout&&a.saveDataByTimeout(),a.targets.each(function(){var b=$(this).attr("id"),c=$(this).find(":input").not(":submit").not(":reset").not(":button");c.each(function(){var c=$(this),d=a.href+b+c.attr("name")+a.options.customKeyPrefix;c.is(":text")||c.is("textarea")?a.options.timeout||a.bindSaveDataImmediately(c,d):a.bindSaveDataOnChange(c,d)})})},saveAllData:function(){var a=this;a.targets.each(function(){var b=$(this).attr("id"),c=$(this).find(":input").not(":submit").not(":reset").not(":button");c.each(function(){var c=$(this),d=a.href+b+c.attr("name")+a.options.customKeyPrefix,e=c.val();c.is(":checkbox")&&(c.attr("name").indexOf("[")!=-1?(e=[],$("[name='"+c.attr("name")+"']:checked").each(function(){e.push($(this).val())})):e=c.is(":checked")),c.is(":radio")&&(e=c.val()),a.saveToLocalStorage(d,e,!1)})}),$.isFunction(a.options.onSave)&&a.options.onSave.call()},restoreAllData:function(){var a=this,b=!1;a.targets.each(function(){var c=$(this),d=c.attr("id"),e=c.find(":input").not(":submit").not(":reset").not(":button");e.each(function(){var c=$(this),e=a.href+d+c.attr("name")+a.options.customKeyPrefix,f=localStorage.getItem(e);f&&(a.restoreFieldsData(c,f),b=!0)})}),b&&$.isFunction(a.options.onRestore)&&a.options.onRestore.call()},restoreFieldsData:function(a,b){a.is(":checkbox")&&b!==!1&&a.attr("name").indexOf("[")===-1?a.attr("checked","checked"):a.is(":radio")?a.val()===b&&a.attr("checked","checked"):a.attr("name").indexOf("[")===-1?a.val(b):(b=b.split(","),a.val(b))},bindSaveDataImmediately:function(a,b){var c=this;$.browser.msie==null?a.get(0).oninput=function(){c.saveToLocalStorage(b,a.val())}:a.get(0).onpropertychange=function(){c.saveToLocalStorage(b,a.val())}},saveToLocalStorage:function(a,b,c){c=c==null?!0:c;try{localStorage.setItem(a,b+"")}catch(d){}c&&b!==""&&$.isFunction(this.options.onSave)&&this.options.onSave.call()},bindSaveDataOnChange:function(a,b){var c=this;a.change(function(){c.saveAllData()})},saveDataByTimeout:function(){var a=this,b=a.targets;setTimeout(function(b){function c(){a.saveAllData(),setTimeout(c,a.options.timeout*1e3)}return c}(b),a.options.timeout*1e3)},bindReleaseData:function(){var a=this;a.targets.each(function(b){var c=$(this),d=c.find(":input").not(":submit").not(":reset").not(":button"),e=c.attr("id");$(this).bind("submit reset",function(){a.releaseData(e,d)})})},releaseData:function(a,b){var c=!1,d=this;b.each(function(){var b=$(this),e=d.href+a+b.attr("name")+d.options.customKeyPrefix;localStorage.removeItem(e),c=!0}),c&&$.isFunction(d.options.onRelease)&&d.options.onRelease.call()}}}var a={instantiated:null,started:null};return{getInstance:function(){return a.instantiated||(a.instantiated=b(),a.instantiated.setInitialOptions()),a.instantiated},free:function(){return a={},null}}}()