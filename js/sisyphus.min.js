$.sisyphus=function(){return Sisyphus.getInstance()},$.fn.sisyphus=function(a){var b=Sisyphus.getInstance();b.setOptions(a),b.protect(this)};var Sisyphus=function(){function b(){return{setOptions:function(a){var b={excludeFields:null,customKeyPrefix:"",timeout:0,onSaveCallback:function(){},onRestoreCallback:function(){},onReleaseDataCallback:function(){}};this.options=this.options||$.extend(b,a)},protect:function(a){a=a||{};var b=this;this.targets=this.targets||[],this.href=location.hostname+location.pathname+location.search,this.targets=$.merge(this.targets,a),this.targets=$.unique(this.targets);var c=[];$(this.targets).each(function(){c.push($(this).html())}),a=[];var d=[];$(c).each(function(b,c){$.inArray(c,a)===-1&&(d.push(b),a.push(c))}),a=[],$(d).each(function(c,d){a.push(b.targets[d])}),this.targets=a,this.targets=$(this.targets);if(!this.isLocalStorageAvailable())return!1;b.restoreFormsData(),b.bindSaveData(),b.bindReleaseData()},isLocalStorageAvailable:function(){try{return localStorage.getItem}catch(a){return!1}},bindSaveData:function(){var a=this;a.options.timeout&&a.saveDataByTimeout(),a.targets.each(function(){var b=$(this).attr("id"),c=$(this).find(":input").not(":submit").not(":reset").not(":button");c.each(function(){var c=$(this),d=a.href+b+c.attr("name")+a.options.customKeyPrefix;c.is(":text")||c.is("textarea")?a.options.timeout||a.bindSaveDataImmediately(c,d):a.bindSaveDataOnChange(c,d)})})},saveAllData:function(){var a=this;a.targets.each(function(){var b=$(this).attr("id"),c=$(this).find(":input").not(":submit").not(":reset").not(":button");c.each(function(){var c=$(this),d=a.href+b+c.attr("name")+a.options.customKeyPrefix,e=c.val();c.is(":checkbox")&&(c.attr("name").indexOf("[")!=-1?(e=[],$("[name='"+c.attr("name")+"']:checked").each(function(){e.push($(this).val())})):e=c.is(":checked")),c.is(":radio")&&(e=c.val()),a.saveToLocalStorage(d,e,!1)})}),$.isFunction(a.options.onSaveCallback)&&a.options.onSaveCallback.call()},restoreFormsData:function(){var a=this,b=!1;a.targets.each(function(){var c=$(this),d=c.attr("id"),e=c.find(":input").not(":submit").not(":reset").not(":button");e.each(function(){var c=$(this),e=a.href+d+c.attr("name")+a.options.customKeyPrefix,f=localStorage.getItem(e);f&&(a.restoreData(c,f),b=!0)})}),b&&$.isFunction(a.options.onRestoreCallback)&&a.options.onRestoreCallback.call()},restoreData:function(a,b){a.is(":checkbox")&&b!==!1&&a.attr("name").indexOf("[")===-1?a.attr("checked","checked"):a.is(":radio")?a.val()===b&&a.attr("checked","checked"):a.attr("name").indexOf("[")===-1?a.val(b):(b=b.split(","),a.val(b))},bindSaveDataImmediately:function(a,b){var c=this;$.browser.msie==null?a.get(0).oninput=function(){c.saveToLocalStorage(b,a.val())}:a.get(0).onpropertychange=function(){c.saveToLocalStorage(b,a.val())}},saveToLocalStorage:function(a,b,c){c=c==null?!0:c;try{localStorage.setItem(a,b+"")}catch(d){}c&&b!==""&&$.isFunction(this.options.onSaveCallback)&&this.options.onSaveCallback.call()},bindSaveDataOnChange:function(a,b){var c=this;a.change(function(){c.saveAllData()})},saveDataByTimeout:function(){var a=this,b=a.targets;setTimeout(function(b){function c(){a.saveAllData(),setTimeout(c,a.options.timeout*1e3)}return c}(b),a.options.timeout*1e3)},bindReleaseData:function(){var a=this;a.targets.each(function(b){var c=$(this),d=c.find(":input").not(":submit").not(":reset").not(":button"),e=c.attr("id");$(this).bind("submit reset",function(){a.releaseData(e,d)})})},releaseData:function(a,b){var c=!1,d=this;b.each(function(){field=$(this);var b=d.href+a+field.attr("name")+d.options.customKeyPrefix;localStorage.removeItem(b),c=!0}),c&&$.isFunction(d.options.onReleaseDataCallback)&&d.options.onReleaseDataCallback.call()}}}var a;return{getInstance:function(){return a||(a=b()),a}}}()